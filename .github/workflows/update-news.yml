name: Update World + C么te d'Ivoire News

on:
  schedule:
    - cron: '0 8 * * *'  # Tous les jours  8h UTC
  workflow_dispatch:

jobs:
  fetch-news:
    runs-on: ubuntu-latest

    env:
      NEWS_API_KEY: ${{ secrets.NEWS_API_KEY }}
      GH_TOKEN: ${{ secrets.GH_TOKEN }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install jq
        run: sudo apt-get update && sudo apt-get install -y jq

      - name: Fetch world headlines
        run: |
          curl "https://newsapi.org/v2/top-headlines?language=en&country=us&apiKey=$NEWS_API_KEY" \
            -o world.json

      - name: Add C么te dIvoire headlines
        run: |
          echo '[
            {
              "en": "C么te dIvoire: four dead in stadium stampede after RHDP meeting",
              "fr": "C么te dIvoire : quatre morts dans une bousculade apr猫s le meeting du RHDP",
              "link": "https://information.tv5monde.com/afrique/cote-divoire-quatre-morts-dans-une-bousculade-apres-le-meeting-du-parti-au-pouvoir-2778479"
            },
            {
              "en": "Technical incident at Abidjan Port quickly resolved",
              "fr": "C么te dIvoire : incident technique au Port dAbidjan rapidement ma卯tris茅",
              "link": "https://www.koaci.com/article/2025/06/24/cote-divoire/societe/cote-divoire-port-dabidjan-un-incident-technique-sur-un-navire-rapidement-maitrise_187958.html"
            }
          ]' > ivoire.json

      - name: Combine world + C么te dIvoire headlines
        run: |
          jq -s '.[0].articles + .[1]' world.json ivoire.json > headlines.json

      - name: Commit updated headlines
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git remote set-url origin https://x-access-token:$GH_TOKEN@github.com/${{ github.repository }}
          git add headlines.json
          git commit -m " Mise  jour quotidienne des actualit茅s monde + C么te dIvoire"
          git push
